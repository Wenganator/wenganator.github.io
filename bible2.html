<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Memory</title>
    <style>
        /* Basic styling for the page */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        /* Styling for each word in the output */
        #output span {
            display: inline-block;
            position: relative;
            overflow: hidden;
        }

        /* Hidden full word that appears on hover */
        #output span::after {
            content: attr(data-full-word); /* Shows the full word */
            position: absolute;
            left: 0;
            top: 0;
            white-space: nowrap;
            overflow: hidden;
            visibility: hidden; /* Hidden by default */
        }

        /* Reveal full word on hover */
        #output span:hover::after {
            visibility: visible;
        }

        /* Ensures only one word is visible at a time */
        #output span:hover {
            z-index: 1;
        }

        /* Optional: Visibility class for hiding elements */
        .hidden-word {
            visibility: hidden;
        }
    </style>
    <link rel="stylesheet" href="styles/style.css">
    <!-- TO-DO: Insert link to unique stylesheet for bible2.html -->
</head>
<body>
    <header>
        <nav id = "navbar">
            <!-- Navigation will be dynamically inserted here -->
        </nav>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&family=Itim&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    </header>

    <main>
        <h1>Bible Passage Search for Memorization</h1>

        <div>
            <label for="translation">Select Translation:</label>
            <select id="translation">
                <option value="ESV" selected>ESV</option>
                <option value="KJV">KJV</option>
                <option value="NASB">NASB</option>
            </select>
        </div>
        <div>
            <label for="book">Select Book:</label>
            <select id="book">
                <option value="Genesis">Genesis</option>
                <option value="Exodus">Exodus</option>
                <option value="Leviticus">Leviticus</option>
                <option value="Numbers">Numbers</option>
                <option value="Deuteronomy">Deuteronomy</option>
                <option value="Joshua">Joshua</option>
                <option value="Judges">Judges</option>
                <option value="Ruth">Ruth</option>
                <option value="1 Samuel">1 Samuel</option>
                <option value="2 Samuel">2 Samuel</option>
                <option value="1 Kings">1 Kings</option>
                <option value="2 Kings">2 Kings</option>
                <option value="1 Chronicles">1 Chronicles</option>
                <option value="2 Chronicles">2 Chronicles</option>
                <option value="Ezra">Ezra</option>
                <option value="Nehemiah">Nehemiah</option>
                <option value="Esther">Esther</option>
                <option value="Job">Job</option>
                <option value="Psalms">Psalms</option>
                <option value="Proverbs">Proverbs</option>
                <option value="Ecclesiastes">Ecclesiastes</option>
                <option value="Song of Solomon">Song of Solomon</option>
                <option value="Isaiah">Isaiah</option>
                <option value="Jeremiah">Jeremiah</option>
                <option value="Lamentations">Lamentations</option>
                <option value="Ezekiel">Ezekiel</option>
                <option value="Daniel">Daniel</option>
                <option value="Hosea">Hosea</option>
                <option value="Joel">Joel</option>
                <option value="Amos">Amos</option>
                <option value="Obadiah">Obadiah</option>
                <option value="Jonah">Jonah</option>
                <option value="Micah">Micah</option>
                <option value="Nahum">Nahum</option>
                <option value="Habakkuk">Habakkuk</option>
                <option value="Zephaniah">Zephaniah</option>
                <option value="Haggai">Haggai</option>
                <option value="Zechariah">Zechariah</option>
                <option value="Malachi">Malachi</option>
                <option value="Matthew">Matthew</option>
                <option value="Mark">Mark</option>
                <option value="Luke">Luke</option>
                <option value="John">John</option>
                <option value="Acts">Acts</option>
                <option value="Romans">Romans</option>
                <option value="1 Corinthians">1 Corinthians</option>
                <option value="2 Corinthians">2 Corinthians</option>
                <option value="Galatians">Galatians</option>
                <option value="Ephesians">Ephesians</option>
                <option value="Philippians">Philippians</option>
                <option value="Colossians">Colossians</option>
                <option value="1 Thessalonians">1 Thessalonians</option>
                <option value="2 Thessalonians">2 Thessalonians</option>
                <option value="1 Timothy">1 Timothy</option>
                <option value="2 Timothy">2 Timothy</option>
                <option value="Titus">Titus</option>
                <option value="Philemon">Philemon</option>
                <option value="Hebrews">Hebrews</option>
                <option value="James">James</option>
                <option value="1 Peter">1 Peter</option>
                <option value="2 Peter">2 Peter</option>
                <option value="1 John">1 John</option>
                <option value="2 John">2 John</option>
                <option value="3 John">3 John</option>
                <option value="Jude">Jude</option>
                <option value="Revelation">Revelation</option>
            </select>
        </div>
        <div>
            <label for="chapter">Enter Chapter:</label>
            <input type="number" id="chapter" min="1">
        </div>
        <div>
            <label for="verse-start">Enter Starting Verse:</label>
            <input type="number" id="verse-start" min="1">
        </div>
        <div>
            <label for="verse-end">Enter Ending Verse (optional):</label>
            <input type="number" id="verse-end" min="1">
        </div>
        <button onclick="searchPassage()">Search</button>
        <div id="output"></div>
        <button onclick="revealFullText()" style="margin-top: 20px;">Reveal Full Text</button>
    </main>

    <footer>
        <p>&copy; 2024 JW</p>
    </footer>

    <script src="scripts/app.js" defer></script>
    

    <script>
        let fullText = ""; // Variable to store the full text of the passage

        // Function to handle the search logic
        async function searchPassage() {
            const translation = document.getElementById("translation").value; // Get selected translation
            const book = document.getElementById("book").value; // Get selected book
            const chapter = document.getElementById("chapter").value; // Get chapter number
            const verseStart = document.getElementById("verse-start").value; // Get starting verse
            const verseEnd = document.getElementById("verse-end").value; // Get ending verse (optional)

            if (!chapter || !verseStart) {
                alert("Please enter both chapter and starting verse.");
                return;
            }

            try {
                // Construct the file path dynamically based on the input
                const response = await fetch(`./assets/json/bible/${getTestament(book)}/${book}/${translation}.json`);
                const data = await response.json(); // Parse the JSON data

                // Find the specific chapter data
                const chapterData = data.text.find(ch => ch.name === `${book} ${chapter}`);

                if (!chapterData) {
                    throw new Error("Passage not found."); // Handle invalid passage
                }

                let verses = chapterData.text; // Extract the verses

                // Filter verses based on the range provided
                const startIndex = parseInt(verseStart) - 1;
                const endIndex = verseEnd ? parseInt(verseEnd) : startIndex + 1;
                verses = verses.slice(startIndex, endIndex);

                // Store the full text for later use
                fullText = verses.map(v => v.text).join(" ");
                displayPassage(verses); // Display the processed passage
            } catch (error) {
                alert("Error: " + error.message); // Show error message to the user
            }
        }

        // Function to display the passage with hover effects
        function displayPassage(verses) {
            const output = document.getElementById("output");
            output.innerHTML = ""; // Clear previous output

            verses.forEach(verse => {
                const words = verse.text.split(" "); // Split verse into words
                words.forEach(word => {
                    const span = document.createElement("span");
                    span.dataset.fullWord = word; // Store full word in data attribute
                    span.textContent = word.charAt(0); // Display only the first letter initially
                    span.style.marginRight = "5px"; // Add spacing between words
                    output.appendChild(span); // Add span to the output
                });
                output.appendChild(document.createElement("br")); // Line break after each verse
            });
        }

        // Function to reveal the full passage text
        function revealFullText() {
            const output = document.getElementById("output");
            output.textContent = fullText; // Replace with the full text
        }

        // Function to determine if the book belongs to the Old or New Testament
        function getTestament(book) {
            const oldTestamentBooks = [
                "Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy", "Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel", 
                "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles", "Ezra", "Nehemiah", "Esther", "Job", "Psalms", "Proverbs", 
                "Ecclesiastes", "Song of Solomon", "Isaiah", "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea", "Joel", "Amos", 
                "Obadiah", "Jonah", "Micah", "Nahum", "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi"
            ];

            // Return "OT" if the book is in the Old Testament list, otherwise "NT"
            return oldTestamentBooks.includes(book) ? "OT" : "NT";
        }
    </script>
</body>
</html>