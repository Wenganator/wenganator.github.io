<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>
            <!-- Add title here -->
        </title>

        <!-- Favicon links (generated by favicon.io) -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="/assets/favicon/site.webmanifest">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

        <!-- My personal CSS -->
        <link rel="stylesheet" href="/styles/fonts.css">
        <link rel="stylesheet" href="/styles/style.css">
        <!-- Add additional stylesheets here to override original styles as needed -->

        <style>
            .list-group-item:hover {
                background-color: #f0f0f0;
                cursor: pointer;
            }
    
            #favoritesPanel {
                position: fixed;
                right: -250px;
                top: 0;
                width: 250px;
                height: 100%;
                background: #f8f9fa;
                padding: 10px;
                overflow-y: auto;
                transition: 0.3s;
                z-index: 1000; /* Ensures it appears above all content */
                box-shadow: -2px 0px 5px rgba(0,0,0,0.2); /* Adds a shadow for better visibility */
            }

            #suggestions {
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                max-height: 200px;
                overflow-y: auto;
                background: white;
                border: 1px solid #ccc;
                z-index: 10;
            }
        </style>
    </head>
    <body>
        <div id="header"></div> <!-- Modify header content in header.html -->

        <div id="favoritesPanel" style="position: fixed; right: -250px; top: 0; width: 250px; height: 100%; background: #f8f9fa; padding: 10px; overflow-y: auto; transition: 0.3s; z-index: 1000;">
            <div class="d-flex justify-content-between align-items-center">
                <h4>Favorites</h4>
                <button class="btn btn-sm btn-danger" onclick="clearAllFavorites()">Clear All</button>
                <button class="btn btn-sm btn-secondary" onclick="toggleFavorites()">Close</button>
            </div>
            <ul id="favoritesList" class="list-group"></ul>
        </div>
        
        <button class="btn btn-secondary" style="position: fixed; right: 10px; top: 10px;" onclick="toggleFavorites()">Favorites</button>
        
        <div class="container mt-5">
            <h2 class="text-center">Word Explorer</h2>

            <div class="mb-3 d-flex position-relative">
                <div class="input-group">
                    <input type="text" id="wordInput" class="form-control" placeholder="Enter a word..."
                        oninput="suggestWords(); updateSearchBarStar();" onfocus="suggestWords()" 
                        onblur="hideSuggestions()" onkeydown="handleKeyPress(event)">
                    <span class="input-group-text favorite-star" 
                        style="cursor: pointer;" 
                        onclick="toggleFavoriteSearchWord()">☆</span>
                    <button class="btn btn-primary" onclick="fetchWords()">Search</button>
                </div>
                <ul id="suggestions" class="list-group position-absolute mt-1 w-100" style="display: none;"></ul>
            </div>
            
            <div class="mt-3">
                <h4>Definition:</h4>
                <p id="definition"></p>
                <h4>Example Sentence:</h4>
                <p id="example"></p>
                <h4>Audio Pronunciation:</h4>
                <audio id="audio" controls style="display: none;"></audio>
            </div>

            <br>

            <div class="row">
                <div class="col-md-4">
                    <h4>Synonyms:</h4>
                    <ul id="synonymsList" class="list-group"></ul>
                </div>
                <div class="col-md-4">
                    <h4>Antonyms:</h4>
                    <ul id="antonymsList" class="list-group"></ul>
                </div>
                <div class="col-md-4">
                    <h4>Rhymes:</h4>
                    <ul id="rhymesList" class="list-group"></ul>
                </div>
            </div>

            <br>
            <br>

            <div class="mt-3">
                <h4>Search History:</h4>
                <ul id="historyList" class="list-group"></ul>
            </div>
            <button class="btn btn-danger mt-2" onclick="clearHistory()">Clear History</button>
            <ul id="historyList" class="list-group"></ul>

            <br>
            <br>
            <br>
        </div>    

        <div id="footer"></div> <!-- Modify footer content in footer.html -->

        <!-- Bootstrap JS (includes Popper.js and Bootstrap JS) -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

        <!-- My personal JS -->
        <script src="/scripts/app.js" defer></script>
        <!-- Add additional JS here as needed -->

        <script>
            function fetchWords(word = null) {
                const inputField = document.getElementById('wordInput');
                const searchWord = word || inputField.value.trim();
                if (!searchWord) return;
                inputField.value = searchWord;

                saveToHistory(searchWord);
                updateSearchBarStar(); // Ensure the star updates when a new word is searched
    
                fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${searchWord}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('definition').innerText = data[0]?.meanings[0]?.definitions[0]?.definition || 'No definition found';
                        document.getElementById('example').innerText = data[0]?.meanings[0]?.definitions[0]?.example || 'No example found';
                        const audio = document.getElementById('audio');
                        const audioSrc = data[0]?.phonetics.find(p => p.audio)?.audio;
                        if (audioSrc) {
                            audio.src = audioSrc;
                            audio.style.display = 'block';
                        } else {
                            audio.style.display = 'none';
                        }
                    });
    
                fetch(`https://api.datamuse.com/words?rel_syn=${searchWord}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('synonymsList').innerHTML = formatList(data);
                    });
    
                fetch(`https://api.datamuse.com/words?rel_ant=${searchWord}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('antonymsList').innerHTML = formatList(data);
                    });
    
                fetch(`https://api.datamuse.com/words?rel_rhy=${searchWord}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('rhymesList').innerHTML = formatList(data);
                    });
            }    
    
            function formatList(data) {
                return data.length ? data.map(item => {
                    const isFavorited = getFavorites().includes(item.word) ? '⭐' : '☆';
                    return `<li class='list-group-item d-flex justify-content-between align-items-center' 
                                onclick='fetchWords("${item.word}")'>
                                <span>${item.word}</span>
                                <span class='favorite-star' onclick='event.stopPropagation(); toggleFavorite("${item.word}")'>${isFavorited}</span>
                            </li>`;
                }).join('') : '<li class="list-group-item">No results found</li>';
            }

            function toggleFavoriteSearchWord() {
                const searchWord = document.getElementById('wordInput').value.trim();
                if (!searchWord) return;

                toggleFavorite(searchWord);
                updateSearchBarStar();
            }

            function updateSearchBarStar() {
                const searchWord = document.getElementById('wordInput').value.trim();
                const star = document.querySelector(".input-group-text.favorite-star");
                star.textContent = getFavorites().includes(searchWord) ? '⭐' : '☆';
            }


            const favoritesKey = "favoriteWordsList";
    
            function getFavorites() {
                return JSON.parse(localStorage.getItem(favoritesKey)) || [];
            }

            function toggleFavorite(word) {
                let favorites = getFavorites();
                if (favorites.includes(word)) {
                    favorites = favorites.filter(fav => fav !== word);
                } else {
                    favorites.push(word);
                }
                localStorage.setItem(favoritesKey, JSON.stringify(favorites));
                displayFavorites();
                updateWordListUI();
                updateSearchBarStar();
            }

    
            function updateWordListUI() {
                document.querySelectorAll('.list-group-item').forEach(item => {
                    const wordSpan = item.querySelector('span');
                    if (!wordSpan) return;
                    
                    const word = wordSpan.textContent.trim();
                    let star = item.querySelector('.favorite-star');
    
                    if (!star) {
                        star = document.createElement('span');
                        star.className = 'favorite-star';
                        item.appendChild(star);
                    }
    
                    star.textContent = getFavorites().includes(word) ? '⭐' : '☆';
                    star.onclick = (event) => {
                        event.stopPropagation();
                        toggleFavorite(word);
                    };
                });
            }

            function displayFavorites() {
                let favorites = getFavorites();
                document.getElementById('favoritesList').innerHTML = favorites.map(item =>
                    `<li class='list-group-item d-flex justify-content-between align-items-center'>
                        <span onclick='fetchWords("${item}")'>${item}</span>
                        <span class='favorite-star' onclick='event.stopPropagation(); toggleFavorite("${item}")'>⭐</span>
                    </li>`
                ).join('');
            }

    
            function toggleFavorites() {
                const panel = document.getElementById('favoritesPanel');
                panel.style.right = panel.style.right === '0px' ? '-250px' : '0px';
            }

            function clearAllFavorites() {
                localStorage.removeItem("favoriteWordsList");
                displayFavorites();
                updateWordListUI();
                updateSearchBarStar();
            }
    
    
            function saveToHistory(word) {
                let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
                if (!history.includes(word)) {
                    history.unshift(word);
                    localStorage.setItem('searchHistory', JSON.stringify(history));
                }
                displayHistory();
            }
    
            function displayHistory() {
                let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
                document.getElementById('historyList').innerHTML = history.map(item => `<li class='list-group-item' onclick='fetchWords("${item}")'>${item}</li>`).join('');
            }
    
            function clearHistory() {
                localStorage.removeItem('searchHistory');
                displayHistory();
            }
    

            function suggestWords() {
                const query = document.getElementById('wordInput').value.trim();
                if (!query) {
                    document.getElementById('suggestions').style.display = 'none';
                    return;
                }
                
                fetch(`https://api.datamuse.com/sug?s=${query}`)
                    .then(response => response.json())
                    .then(data => {
                        const suggestions = document.getElementById('suggestions');
                        suggestions.innerHTML = data.map(item => {
                            const isFavorited = getFavorites().includes(item.word) ? '⭐' : '☆';
                            return `<li class='list-group-item d-flex justify-content-between align-items-center' 
                                        onclick='fetchWords("${item.word}")'>
                                        <span>${item.word}</span>
                                        <span class='favorite-star' onclick='event.stopPropagation(); toggleFavorite("${item.word}")'>${isFavorited}</span>
                                    </li>`;
                        }).join('');
                        suggestions.style.display = 'block';
                    });
            }


            function hideSuggestions() {
                setTimeout(() => document.getElementById('suggestions').style.display = 'none', 200);
            }
    
            function handleKeyPress(event) {
                if (event.key === 'Enter') {
                    fetchWords();
                }
            }
    
            displayHistory();
            displayFavorites();
            updateWordListUI();
            updateSearchBarStar();
        </script>
    </body>
</html>